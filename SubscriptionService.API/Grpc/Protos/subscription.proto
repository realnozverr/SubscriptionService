syntax = "proto3";

import "google/protobuf/timestamp.proto";

option csharp_namespace = "Proto.SubscriptionV1";

package subscription.v1;  // Изменено на lowercase

// Уникальные значения с префиксами
enum SubscriptionStatusProto {
  SUBSCRIPTION_STATUS_UNKNOWN = 0;
  SUBSCRIPTION_STATUS_ACTIVE = 1;
  SUBSCRIPTION_STATUS_EXPIRED = 2;
  SUBSCRIPTION_STATUS_CANCELLED = 3;
}

enum UserStatusProto {
  USER_STATUS_UNKNOWN = 0;
  USER_STATUS_ACTIVE = 1;
  USER_STATUS_BLOCKED = 2;
  USER_STATUS_EXPIRED = 3;
}

service SubscriptionService {
  rpc GetOrCreateUser (GetOrCreateUserRequest) returns (UserResponse);
  rpc ListAvailablePlans (ListAvailablePlansRequest) returns (ListAvailablePlansResponse);
  rpc CreatePaymentOrder (CreatePaymentOrderRequest) returns (CreatePaymentOrderResponse);
  rpc GetSubscriptionStatus (GetSubscriptionStatusRequest) returns (SubscriptionStatusResponse);
}

// --- GetOrCreateUser ---
message GetOrCreateUserRequest {
  int64 telegram_id = 1;
  string telegram_username = 2;
}

message UserResponse {
  string user_id = 1;
  int64 telegram_id = 2;
  UserStatusProto status = 3; 
  optional string vpn_identifier = 4;  
  google.protobuf.Timestamp created_at = 5;  
}

// --- ListAvailablePlans ---
message ListAvailablePlansRequest {}

message ListAvailablePlansResponse {
  repeated Plan plans = 1;
}

message Plan {
  string id = 1;
  string name = 2;
  string description = 3;
  double price = 4;
  string currency = 5;
  int32 duration_days = 6;  
}

// --- CreatePaymentOrder ---
message CreatePaymentOrderRequest {
  string user_id = 1;
  string plan_id = 2;
}

message CreatePaymentOrderResponse {
  string payment_url = 1;
  string order_id = 2;
  google.protobuf.Timestamp valid_until = 3;  
}

// --- GetSubscriptionStatus ---
message GetSubscriptionStatusRequest {
  string user_id = 1;
}

message SubscriptionStatusResponse {
  string plan_id = 1;  
  string plan_name = 2;
  SubscriptionStatusProto status = 3;  
  google.protobuf.Timestamp start_date_utc = 4; 
  google.protobuf.Timestamp end_date_utc = 5;  
  bool has_active_subscription = 6;
}